<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>Energy rates - Predbat Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Energy rates";
        var mkdocs_page_input_path = "energy-rates.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> Predbat Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="..">Introduction</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../what-does-predbat-do/">What does Predbat do?</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../caution/">Words of caution</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Installing & configuring Predbat</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../installation-summary/">Install summary</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../install/">Install details</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../inverter-setup/">Inverter setup</a>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="#">Energy rates</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#octopus-energy-direct">Octopus Energy direct</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#octopus-free-energy-sessions">Octopus Free energy sessions</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#octopus-energy-home-assistant-integration">Octopus Energy Home Assistant Integration</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#octopus-energy-integration-setup">Octopus Energy integration setup</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#configuring-predbat-to-use-the-octopus-energy-integration">Configuring Predbat to use the Octopus Energy integration</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#standing-charge">Standing charge</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#octopus-saving-sessions">Octopus Saving sessions</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#octopus-free-power-up-events">Octopus free (power up) events</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#octopus-rates-url">Octopus Rates URL</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#energidataservice-integration">Energidataservice Integration</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#configuring-predbat-to-use-the-energidataservice-integration">Configuring Predbat to Use the Energidataservice Integration</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#other-energy-spot-rate-sensor-integrations">Other Energy Spot Rate sensor integrations</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#czech-republic-example">Czech Republic example</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#frank-energie-export-rates-with-export-fee">Frank Energie Export rates with export fee</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#rate-bands-to-manually-configure-energy-rates">Rate Bands to manually configure Energy Rates</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#manually-over-riding-energy-rates">Manually over-riding energy rates</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#rate-offsets">Rate offsets</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#future-agile-energy-rates">Future Agile energy rates</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#grid-carbon-intensity">Grid Carbon intensity</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#uk-grid-carbon-intensity">UK Grid Carbon intensity</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#uk-grid-carbon-intensity-ha-integration">UK Grid Carbon intensity (HA Integration)</a>
    </li>
        </ul>
    </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../apps-yaml/">apps.yaml settings</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../components/">Predbat Components Documentation</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../car-charging/">Car charging</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../configuration-guide/">Configuration guide</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../customisation/">Customisation</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../video-guides/">Video Guides</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../faq/">FAQ</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../devices/">Support 3rd party devices/integrations</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../manual-api/">Predbat automation API</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Viewing Predbat data</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../output-data/">Output data</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../web-interface/">Web Interface</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../predbat-plan-card/">Predbat Plan card</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../creating-charts/">Creating the charts</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../compare/">Comparing Energy Tariffs</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Predbat development</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../todo-list/">To-do list</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../developing/">Developing on Predbat</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../rest_api/">Predbat REST API</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../plugins/">ðŸš€ Feature: Plugin System Implementation</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Predheat</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../predheat/">Predheat</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">Predbat Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">Installing & configuring Predbat</li>
      <li class="breadcrumb-item active">Energy rates</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="energy-rates">Energy rates</h1>
<p>Predbat needs to know what your Import and (optionally) Export rates are so it can plan the optimal way to use your battery.
Your Import and Export rates can be simple flat rates,
more complex time-of-day tariffs (e.g. Economy 7, Octopus Flux),
or daily/half-hourly rates that track electricity market prices (e.g. Octopus Agile or Tracker).</p>
<p>Energy rates are all configured in the <code>apps.yaml</code> file that's stored in either the directory <code>/addon_configs/6adb4f0d_predbat</code> or <code>/config/appdaemon/apps/batpred/config/</code> directory
depending on <a href="../apps-yaml/#appsyaml-settings">what type of Predbat installation method you have used</a>.</p>
<p>You will need to use a file editor within Home Assistant (e.g. either the File editor or Studio Code Server add-ons)
to edit this file - see <a href="../install/#editing-configuration-files-in-home-assistant">editing configuration files within Home Assistant</a> if you need to install an editor.</p>
<p>There are four different ways of configuring your Energy rates in <code>apps.yaml</code>, using <a href="#octopus-energy-direct">Octopus Energy Direct</a>,
using the <a href="#octopus-energy-home-assistant-integration">Octopus Energy Integration</a>, using <a href="#octopus-rates-url">Octopus Rates URL's</a>,
or manually <a href="#rate-bands-to-manually-configure-energy-rates">defining your rates and time periods</a>.</p>
<p>At least one of these methods must be used to define your import and export rates. If you don't then Predbat will assume zero for your energy rates.</p>
<h2 id="octopus-energy-direct">Octopus Energy direct</h2>
<p>If your electricity supplier is Octopus Energy then the simplest way to provide Predbat with your electricity pricing information is to connect Predbat directly to Octopus.</p>
<ul>
<li>This method will not work correctly if you have multiple import or export meters.</li>
<li>A single Octopus Intelligent GO car charger or car is supported and Predbat will plan your battery charging based on iGo sessions.</li>
<li>Saving sessions are also supported, including Predbat auto-enrolling you to them (note you must be joined to both the Octopus Octopoints and then the Saving Sessions schemes beforehand).</li>
</ul>
<p>You should first log into your Octopus account and go to the <a href="https://octopus.energy/dashboard/new/accounts/">Accounts</a> section and copy your Octopus account number e.g. <code>A-1234567</code>.</p>
<p>Then go to the <a href="https://octopus.energy/dashboard/new/accounts/personal-details/api-access">API Access page</a>, click 'regenerate API key' and copy your API key e.g. <code>sk_live_1as12355...</code></p>
<p>Put these both into your <code>apps.yaml</code> and you are done.</p>
<pre><code class="language-yaml">  octopus_api_account: 'XXXXXXXX'
  octopus_api_key: 'sk_live_yyyyyyyy'
</code></pre>
<h3 id="octopus-free-energy-sessions">Octopus Free energy sessions</h3>
<p>Predbat can obtain details of Free energy sessions directly from the Octopus Web Site.
As Octopus do not publish an API for this information it has to be done by 'scraping' the website - there may be future issues with this if Octopus ever change the website format.
If you enable free energy sessions in Predbat then sessions will be considered even if you forget to sign-up to them in your Octopus account so be careful!</p>
<pre><code class="language-yaml">  octopus_free_url: 'http://octopus.energy/free-electricity'
</code></pre>
<h2 id="octopus-energy-home-assistant-integration">Octopus Energy Home Assistant Integration</h2>
<h3 id="octopus-energy-integration-setup">Octopus Energy integration setup</h3>
<p>Instead of using Octopus Energy Direct method, Predbat can also work with the <a href="https://github.com/BottlecapDave/HomeAssistant-OctopusEnergy/">Octopus Energy integration</a>,
this brings greater configurability than the direct method.</p>
<p>The Octopus Energy integration connects to your Octopus Energy account and retrieves the tariffs you are on, and the current tariff rates.
If you change tariff within Octopus the integration will automatically retrieve the updated tariff information, and as tariff prices change, again they are automatically retrieved.</p>
<p>The integration also provides support for Intelligent Octopus charging to support (multiple) car charging.</p>
<p>Follow the instructions provided in the Octopus Energy integration documentation to install and set up the integration.</p>
<p>Once installed, you will need to configure the integration (go to Settings / Devices &amp; Services / Integrations / Octopus Energy then click 'Configure')
and provide the integration with your 'Octopus API key' (that you obtain from your Octopus account: Personal Details / API access).</p>
<p><strong>CAUTION</strong> To get detailed energy rates needed by Predbat you need to go into Home Assistant and manually enable the following Octopus Energy events which are disabled by default when the integration is installed:</p>
<pre><code class="language-yaml">  event.octopus_energy_electricity_xxxxxxxx_previous_day_rates
  event.octopus_energy_electricity_xxxxxxxx_current_day_rates
  event.octopus_energy_electricity_xxxxxxxx_next_day_rates

  event.octopus_energy_electricity_xxxxxxxx_export_previous_day_rates
  event.octopus_energy_electricity_xxxxxxxx_export_current_day_rates
  event.octopus_energy_electricity_xxxxxxxx_export_next_day_rates

  event.octopus_energy_gas_xxxxxxxx_previous_day_rates
  event.octopus_energy_gas_xxxxxxxx_current_day_rates
  event.octopus_energy_gas_xxxxxxxx_next_day_rates
</code></pre>
<p>To enable the above events:</p>
<ul>
<li>Go to Settings / Devices &amp; Services / Integrations, choose Octopus Energy, then <em>xx entities</em></li>
<li>You will see a list of entities (and events) supplied by the Octopus integration</li>
<li>Click the 'Filter' symbol on the top right-hand corner (a series of lines in a downwards pointing arrow) and make sure all the options are selected</li>
<li>Then in the left-hand-side search entities box, type "current_day"</li>
<li>Click on the first event that comes up, check the name is the right one</li>
<li>Click the cog wheel, then you should see the option to enable the event</li>
<li>Click the option to enable the event and press 'Update' to make the change</li>
</ul>
<p>Repeat this for the other events.</p>
<p>The gas rates are only required if you have a gas boiler, and an iBoost, and are <a href="../customisation/#iboost-energy-rate-filtering">using Predbat to determine whether it's cheaper to heat your hot water with the iBoost or via gas</a></p>
<p>Verify that the integration is working correctly in Home Assistant by going to Developer Tools / States, and entering 'octopus' in the 'Filter entities' box.
Confirm that the Octopus entities are being populated correctly.</p>
<h3 id="configuring-predbat-to-use-the-octopus-energy-integration">Configuring Predbat to use the Octopus Energy integration</h3>
<p>The following configuration items in apps.yaml are used to configure Predbat to use the Octopus Energy integration.
They are set to a regular expression and should be auto-discovered so that Predbat automatically uses the Octopus Energy integration,
but you can comment out the regular expression lines to disable, or you set them manually.</p>
<ul>
<li><strong>metric_octopus_import</strong> - Import rates from the Octopus Energy integration, should point to the sensor sensor.octopus_energy_electricity_METER_NUMBER_current_rate</li>
<li><strong>metric_octopus_export</strong> - Export rates from the Octopus Energy integration, should point to the sensor sensor.octopus_energy_electricity_METER_NUMBER_export_current_rate</li>
<li><strong>metric_octopus_gas</strong> - Gas rates from the Octopus Energy integration, should point to the sensor sensor.octopus_energy_gas_METER_NUMBER_current_rate</li>
<li><strong>octopus_intelligent_slot</strong> - If you have the Octopus Intelligent Go tariff this should point to the 'slot' sensor binary_sensor.octopus_energy_DEVICE_ID_intelligent_dispatching</li>
</ul>
<p>metric_octopus_gas is (as above) only required to be configured if you are using Predbat to determine whether to heat your hot water via your iBoost or gas.</p>
<p>If you do not have an export rate or are not on the Octopus Go tariff, then the appropriate lines can be commented out in apps.yaml.</p>
<p>NOTE: Predbat using the Octopus integration rates relies upon the day rate events being enabled (see above) and the events and the sensor found by metric_octopus_xxx in <code>apps.yaml</code> being similarly named.<BR>
There have been occasions with some Octopus Integration installations where the event name is as above but the sensor name has a different prefix, e.g. sensor.electricity_METER_NUMBER_current_rate and not sensor.octopus_energy_electricity_METER_NUMBER_current_rate.<BR>
If this is the case then the sensor must be renamed to the correct format so that Predbat can function correctly.</p>
<h3 id="standing-charge">Standing charge</h3>
<p>Predbat can also (optionally) include the daily standing charge in cost predictions.
The following configuration item in apps.yaml defaults to obtaining the standing charge from the Octopus Energy integration:</p>
<ul>
<li><strong>metric_standing_charge</strong> - Standing charge in pounds. By default points to the Octopus Energy integration sensor sensor.octopus_energy_electricity_METER_NUMBER_current_standing_charge</li>
</ul>
<p>You can manually change this to a standing charge in pounds, e.g. 0.50 is 50p, or delete this line from apps.yaml, or set it to zero
if you don't want the standing charge (and only have consumption usage) to be included in Predbat charts and output data.</p>
<p>Note that this configuration option to suppress the standing charge only applies if you are using the Octopus Integration from Predbat.
If you are using the Octopus Energy direct method of Predbat directly connecting to Octopus then the standing charge will always be included in the plan and charts.</p>
<h3 id="octopus-saving-sessions">Octopus Saving sessions</h3>
<p>Predbat can automatically join you to Octopus saving sessions and plan battery activity for the saving session period to maximise your income.</p>
<p>Note: <strong>You must have signed up to both the Octopus Octoplus and then the Saving Session schemes to benefit from these events</strong></p>
<p>For Predbat to automatically manage Octopus saving sessions the following additional configuration item in <code>apps.yaml</code> is used.
Like the electricity rates, this is set in the <code>apps.yaml</code> template to a regular expression that should auto-discover the Octopus Energy integration.</p>
<ul>
<li><strong>octopus_saving_session</strong> - Indicates if a saving session is active, should point to the sensor binary_sensor.octopus_energy_ACCOUNT_ID_octoplus_saving_sessions.</li>
</ul>
<p>When a saving session is available it will be automatically joined by Predbat and should then appear as a joined session within the next 30 minutes.</p>
<p>NOTE: Predbat automatically joining the saving session relies upon the event being enabled and Predbat being able to find the saving session event as 'event.octopus_energy_ACCOUNT_ID_octoplus_saving_session_events' - there have been occasions
with some Octopus Integration installations where the event name is different.  If this is the case then the event must be renamed to the correct format that Predbat can function correctly.</p>
<p>In the Predbat plan, for joined saving sessions the energy rates for import and export will be overridden by adding the assumed saving rate to your normal rate.
The assumed rate will be taken from the Octopus Energy integration and converted into pence
using the <strong>octopus_saving_session_octopoints_per_penny</strong> configuration item in apps.yaml (default is 8).</p>
<p>If you normally cut back your house usage during a saving session then you can change <strong>input_number.predbat_load_scaling_saving</strong> to allow Predbat to assume an energy
reduction in this period. E.g. setting to a value of 0.8 would indicate you will use 80% of the normal consumption in that period (a 20% reduction).</p>
<p>As the saving session import and export rates are very high compared to normal Predbat will plan additional export during the saving session period.
If necessary, a pre-charge may happen at some point during the day to maintain the battery right level for the session.</p>
<p>Note that Predbat's operational mode <strong>select.predbat_mode</strong> must be set to either 'Control charge'
or 'Control charge &amp; discharge' for Predbat to be able to manage the battery for the saving session.</p>
<p>If you do not have an export tariff then forced export will not apply and Predbat will just ensure you have enough battery charge to see you through the saving session period.</p>
<p>If you do not want Predbat to automatically join Octopus saving sessions and manage your battery activity for the session,
simply delete or comment out the <strong>octopus_saving_session</strong> entry in <code>apps.yaml</code>.</p>
<h3 id="octopus-free-power-up-events">Octopus free (power up) events</h3>
<p>Predbat can automatically detect Octopus free events and adjust your battery plan according. Note that this is derived from external sources, which do not verify your eligibility for free sessions.</p>
<p>For Predbat to automatically manage Octopus free sessions the following additional configuration item in apps.yaml is used.</p>
<p>Note: <strong>You must have signed up to the Octopus Octoplus scheme and eligible to benefit from these events</strong></p>
<p>Like the electricity rates, this is set in the apps.yaml template to a regular expression that should auto-discover the Octopus Energy integration.</p>
<p><strong>octopus_free_session</strong> - Will point to the free event sensor that is exposed by the Octopus Energy Integration. This event sensor contains the dates/times of
all the free events.</p>
<pre><code class="language-yaml">  octopus_free_session: 're:(event.octopus_energy_([0-9a-z_]+|)_octoplus_free_electricity_session_events)'
</code></pre>
<p>Note: <strong>This event may need to be enabled in Home Assistant first</strong> - see <a href="https://bottlecapdave.github.io/HomeAssistant-OctopusEnergy/faq/#there-are-entities-that-are-disabled-why-are-they-disabled-and-how-do-i-enable-them">How to Enable Octopus events</a></p>
<p>If you normally increase your house usage during a free session then you can change <strong>input_number.predbat_load_scaling_free</strong> to allow Predbat to assume an energy
increase in this period. E.g. setting to a value of 1.2 would indicate you will use 20% more energy than normal during this period. (Default is 1.2)</p>
<p>If you do not want Predbat to see these sessions then comment out the <strong>octopus_free_session</strong> setting.</p>
<p>Note: If the above is not working due to a lack of data (via a 3rd party service) Predbat can scrape directly from the Octopus Web Site, this may
not work in future if Octopus ever change the website format. If you enable this then sessions will be considered by Predbat even if you forget to sign-up to free electricity sessions in your Octopus account so be careful!</p>
<pre><code class="language-yaml">  octopus_free_url: 'http://octopus.energy/free-electricity'
</code></pre>
<h2 id="octopus-rates-url">Octopus Rates URL</h2>
<p>As an alternative to the Octopus Direct or Octopus Energy integration methods, for Octopus Energy customers,  you can configure Predbat to get the electricity rates directly online from the Octopus website.</p>
<p>In apps.yaml configure the following lines:</p>
<ul>
<li><strong>rates_import_octopus_url</strong> to point to the appropriate import tariff URL on the Octopus website</li>
<li><strong>rates_export_octopus_url</strong> to point to the export tariff URL</li>
</ul>
<p>e.g. (for DNO region A)</p>
<pre><code class="language-yaml">  rates_import_octopus_url : &quot;https://api.octopus.energy/v1/products/FLUX-IMPORT-23-02-14/electricity-tariffs/E-1R-FLUX-IMPORT-23-02-14-A/standard-unit-rates&quot;
  rates_import_octopus_url : &quot;https://api.octopus.energy/v1/products/AGILE-24-10-01/electricity-tariffs/E-1R-AGILE-24-10-01-A/standard-unit-rates&quot;

  rates_export_octopus_url: &quot;https://api.octopus.energy/v1/products/FLUX-EXPORT-23-02-14/electricity-tariffs/E-1R-FLUX-EXPORT-23-02-14-A/standard-unit-rates&quot;
  rates_export_octopus_url: &quot;https://api.octopus.energy/v1/products/AGILE-OUTGOING-19-05-13/electricity-tariffs/E-1R-AGILE-OUTGOING-19-05-13-A/standard-unit-rates/&quot;
</code></pre>
<p>If you configure the rates_import_octopus_url then Predbat will use this instead of metric_octopus or rates_import.
Similarly, rates_export_octopus_url takes precedence over metric_octopus_export or rates_export.</p>
<p>A full list of available Octopus products is at <a href="https://api.octopus.energy/v1/products/">https://api.octopus.energy/v1/products/</a>.</p>
<p>If you view this page, search for the tariff by name, then copy the URL it shows into a new tab.</p>
<p>E.g. <a href="https://api.octopus.energy/v1/products/GO-VAR-22-10-14/">https://api.octopus.energy/v1/products/GO-VAR-22-10-14/</a></p>
<p>Look through that page to find the right URL for usage charges in your DNO area</p>
<p><a href="https://api.octopus.energy/v1/products/GO-VAR-22-10-14//electricity-tariffs/E-1R-GO-VAR-22-10-14-A/standard-unit-rates">https://api.octopus.energy/v1/products/GO-VAR-22-10-14//electricity-tariffs/E-1R-GO-VAR-22-10-14-A/standard-unit-rates</a></p>
<p>(For area A)</p>
<p>Configuring the Octopus rates URL is an expert feature as Octopus change the available products from time to time, so for most users, the Octopus Direct or Octopus Energy integration are simpler solutions.</p>
<h2 id="energidataservice-integration">Energidataservice Integration</h2>
<p><a href="https://github.com/MTrab/energidataservice">https://github.com/MTrab/energidataservice</a></p>
<p>If your electricity supplier provides data through the Energi Data Service, you can use the Energidataservice integration to fetch real-time and future electricity pricing data.
This integration allows you to automatically retrieve rates and apply them within your energy management system, including optional tariff adjustments for greater accuracy.</p>
<p>The integration processes hourly pricing data and converts it into 30-minute intervals, making it ideal for scheduling and optimizing energy usage.</p>
<h3 id="configuring-predbat-to-use-the-energidataservice-integration">Configuring Predbat to Use the Energidataservice Integration</h3>
<p>The following configuration items in <code>apps.yaml</code> are used to configure Predbat to use the Energidataservice integration. These items must be set explicitly to ensure that Predbat retrieves the correct import and export rates.</p>
<ul>
<li>
<p><strong>metric_energidataservice_import</strong> - Import rates from the Energidataservice integration. This should point to the sensor that provides hourly import rates, such as sensor.energi_data_service.</p>
</li>
<li>
<p><strong>metric_energidataservice_export</strong> - Export rates from the Energidataservice integration. This should point to the sensor that provides hourly export rates (e.g., solar feed-in rates), such as sensor.energi_data_service_export.</p>
</li>
</ul>
<h2 id="other-energy-spot-rate-sensor-integrations">Other Energy Spot Rate sensor integrations</h2>
<p>Different spot rate integrations that include forecast prices may be used.
Because integrations format their attribute data differently, a template sensor is required to convert the attribute data into a new sensor with the correctly formatted attributes: raw_today and raw_tomorrow.</p>
<pre><code class="language-yaml">  metric_octopus_import: 'sensor.current_buy_electricity_price_raw'
  metric_octopus_export: 'sensor.current_sell_electricity_price_raw'
</code></pre>
<h3 id="czech-republic-example">Czech Republic example</h3>
<p><a href="https://github.com/rnovacek/homeassistant_cz_energy_spot_prices">https://github.com/rnovacek/homeassistant_cz_energy_spot_prices</a></p>
<pre><code class="language-yaml">{% set attributes = states.sensor.current_buy_electricity_price.attributes %}
{% set datetime_dict = zip(attributes.keys() | map('as_datetime', default={}), attributes.values()) | selectattr(0, 'datetime') %}
{% set ns = namespace(output=[]) %}
{% for start_time, price in datetime_dict %}
 {% if start_time &lt; today_at() + timedelta(days=1) %}
   {% set ns.output = ns.output + [{'start': start_time.isoformat(), 'end': (start_time + timedelta(hours=1)).isoformat(), 'value': price | round(5)}] %}
 {% endif %}
{% endfor %}
{{ns.output | sort(attribute='start') }}
</code></pre>
<p>Full code for CZ energy spot rate template:
<a href="https://gist.github.com/ziat007/ae29e26ae257f069520b65f0168c3a6b">https://gist.github.com/ziat007/ae29e26ae257f069520b65f0168c3a6b</a></p>
<h3 id="frank-energie-export-rates-with-export-fee">Frank Energie Export rates with export fee</h3>
<p>The <a href="https://github.com/HiDiHo01/home-assistant-frank_energie">Frank Energie integration</a> provides import and export rates for Frank Energie customers in the Netherlands.
However the integration provides only the market rates and does not include the export fixed fee of 0.0115 per kWh.</p>
<p>A template sensor can be used to manipulate the rates provided by the integration and add the required fee:</p>
<pre><code class="language-yaml">      # Export to Grid Payment
      - name: &quot;Frank export price schedule (â‚¬/kWh)&quot;
        unique_id: frank_export_price_schedule_eur_kwh
        unit_of_measurement: &quot;â‚¬/kWh&quot;
        icon: mdi:currency-eur
        state_class: measurement
        state: &gt;
          {% set src = 'sensor.frank_energie_prices_current_electricity_market_price' %}
          {% set fee = states('input_number.frank_export_fee_eur_per_kwh') | float(0.0115) %}
          {% set arr = state_attr(src, 'prices') or [] %}
          {% set now_ = now() %}
          {% set price = states(src) | float(0) %}
          {% for b in arr %}
            {% if now_ &gt;= as_datetime(b['from']) and now_ &lt; as_datetime(b['till']) %}
              {% set price = b['price'] | float(0) %}
            {% endif %}
          {% endfor %}
          {{ (price - fee) | round(5) }}
        attributes:
          prices: &gt;
            {% set src = 'sensor.frank_energie_prices_current_electricity_market_price' %}
            {% set fee = states('input_number.frank_export_fee_eur_per_kwh') | float(0.0115) %}
            {% set arr = state_attr(src, 'prices') or [] %}
            {% set out = namespace(list=[]) %}
            {% for b in arr %}
              {% set p = (b['price'] | float(0)) - fee %}
              {% set item = {'from': b['from'].strftime('%Y-%m-%dT%H:%M:%S%z'), 'till': b['till'].strftime('%Y-%m-%dT%H:%M:%S%z'), 'price': (p | round(5))} %}
              {% set out.list = out.list + [item] %}
            {% endfor %}
            {{ out.list | tojson }}
</code></pre>
<h2 id="rate-bands-to-manually-configure-energy-rates">Rate Bands to manually configure Energy Rates</h2>
<p>If you are not an Octopus Energy customer, or you are but your energy rates repeat simply, you can configure your rate bands in apps.yaml using rates_import/rates_export/rates_gas.</p>
<p>Add the following entries to apps.yaml to define the pattern of rates over 24 hours:</p>
<pre><code class="language-yaml">  rates_import:
    - start: &quot;HH:MM:SS&quot;
      end: &quot;HH:MM:SS&quot;
      rate: pence
  rates_export:
    - start: &quot;HH:MM:SS&quot;
      end: &quot;HH:MM:SS&quot;
      rate: pence
  rates_gas:
    - start: &quot;HH:MM:SS&quot;
      end: &quot;HH:MM:SS&quot;
      rate: pence
</code></pre>
<p><strong>start</strong> and <strong>end</strong> are in the time format of "HH:MM:SS" e.g. "12:30:00" and should be aligned to 30 minute slots normally, i.e. end with ":30:00" or ":00:00".
Make sure the start and end times for the different rates cover the whole 24 hour period with no gaps!
<strong>rate</strong> is in pence e.g. 4.2</p>
<p><strong>day_of_week</strong> Can also be used to control rates on specific days. You can specify one day or multiple days split by a comma.
Note: Day 1 = Monday, 2 = Tuesday .... 7 = Sunday</p>
<p>e.g:</p>
<pre><code class="language-yaml">  rates_import:
    - rate: 15
      day_of_week: &quot;1,2,3,4,5&quot;
    - rate: 10
      day_of_week: &quot;6,7&quot;
</code></pre>
<p>start and end can be omitted and Predbat will assume that you are on a single flat-rate tariff.</p>
<p>If there are any gaps in the 24-hour period then a zero rate will be assumed.</p>
<p>The gas rates are only required if you have a gas boiler, or an iBoost, and are using Predbat to determine whether it's cheaper to heat your hot water with the iBoost or via gas.</p>
<h2 id="manually-over-riding-energy-rates">Manually over-riding energy rates</h2>
<p>You can also override the import or export energy rates (regardless of whether they are set manually or via the Octopus Energy integration) by using the override feature in apps.yaml.</p>
<p>Rate override is used to set the specific date and time period where your rates are different, e.g. an Octopus Power Up session (zero rate for an hour or two),
or the British Gas half-price electricity on Sundays.</p>
<p>Unfortunately, there aren't any API's available to feed this information automatically into Predbat so you will have to define your own input controls and use the <a href="../manual-api/#example-solution-to-over-ride-predicted-house-load">Predbat manual API</a>,
or edit <code>apps.yaml</code> manually to set the appropriate rate over-ride dates and times:</p>
<pre><code class="language-yaml">  rates_import_override:
    - date: &quot;YYYY-MM-DD&quot;
      start: &quot;HH:MM:SS&quot;
      end: &quot;HH:MM:SS&quot;
      rate: pence
  rates_export_override:
    - date: &quot;YYYY-MM-DD&quot;
      start: &quot;HH:MM:SS&quot;
      end: &quot;HH:MM:SS&quot;
      rate: pence
</code></pre>
<p>Optionally you can add a predicted load scaling factor for these periods using <strong>load_scaling</strong>, for example:</p>
<pre><code class="language-yaml">  rates_import_override:
    - date: '2024-01-21'
      start: '17:30:00'
      end: '18:30:00'
      rate: 150
      load_scaling: 0.8
</code></pre>
<p>This instructs Predbat that during a 1-hour period at 5:30-6:30pm on 21st of Jan set the import rate to 150p and assume our load will be 80% of normal (20% lower).</p>
<p>You can also make relative adjustments to your energy rates, e.g. if you want to avoid exporting during peak periods to improve your energy
saving session results you could make a relative adjustment to your export rates using <strong>rate_increment</strong>.
The reason not to just set <strong>rate</strong> is that when an energy saving session is active you do not want to ignore the higher export rate that is automatically provided by Octopus.</p>
<p>In this example we subtract 10p from our export rate during the period that saving sessions normally fall within and thus steer Predbat away from
force exporting during that time. The saving session will still work correctly as a 10p adjustment on rates &gt;100p will have little/no impact.</p>
<pre><code class="language-yaml">  rates_export_override:
    - start: '17:00:00'
      end: '19:00:00'
      rate_increment: -10
</code></pre>
<p>You can also use a similar but opposite approach of setting a positive export rate_increment to encourage Predbat to discharge the battery at certain time periods.</p>
<p>If you have a very low overnight rate (such as Octopus Go) and want to ensure your battery is discharged just before the low rate period,
but you don't want to risk the battery running out too early (and importing at a higher rate),
you can add a rate export override for the period you want to discharge just before the low rate period:</p>
<pre><code class="language-yaml">  rates_export_override:
    - start: '22:30:00'
      end: '23:30:00'
      rate_increment: 10
</code></pre>
<p>You can also define an import_rate_override with start and end times and only load_scaling (without a rate_increment or rate), e.g. if you just want to apply load scaling to certain defined periods.</p>
<ul>
<li><strong>date</strong> is optional and if specified must be in the date format of "YYYY-MM-DD" e.g. "2023-09-09".
If a date is specified then the rate override applies to that specific date, otherwise, it applies to all dates</li>
<li><strong>start</strong> and <strong>end</strong> must be specified in "HH:MM:SS" time format e.g. "12:30:00"</li>
<li><strong>load_scaling</strong> is an optional percentage change factor in house load for the period - 1.0 would be no change, 0.8 is 80% of nominal house load,
2.0 would be a 100% increase (i.e. 2x) on normal historic house load</li>
<li><strong>rate</strong> is an optional figure in pence to override the rate for the specific period</li>
<li><strong>rate_increment</strong> is optional and is the number of pence to add (or subtract) to the reported energy rates during this period</li>
</ul>
<h2 id="rate-offsets">Rate offsets</h2>
<p>If you are on an Agile or Tracker tariff you can tune future unknown energy rates by adjusting the entities <strong>input_number.predbat_metric_future_rate_offset_import</strong> (<em>expert mode</em>)
and <strong>input_number.predbat_metric_future_rate_offset_export</strong> (<em>expert mode</em>) inside Home Assistant to set the predicted offset for future unknown rates.</p>
<h2 id="future-agile-energy-rates">Future Agile energy rates</h2>
<p>In the energy market, it's possible to calculate the Octopus Agile rates from around 10am UK time using public data, you can
enable this in apps.yaml for Import, Export or both. This will approximate the next day's rates based on the spot prices.
The approximation is only used until the real Octopus Agile rates are released around 4pm.</p>
<ul>
<li><strong>futurerate_url</strong> - URL of future energy market prices; this should not normally need to be changed</li>
<li><strong>futurerate_adjust_import</strong> and <strong>futurerate_adjust_export</strong> - Whether tomorrow's predicted import or export prices should be adjusted based on energy market prices or not.
Set these depending on whether you have an agile tariff for import, export or both</li>
<li><strong>futurerate_peak_start</strong> and <strong>futurerate_peak_end</strong> - during the peak period Octopus applies an additional peak-rate price adjustment.
These configuration items enable the peak-rate hours to be adjusted</li>
</ul>
<p>CAUTION: You may violate the terms and conditions of the Nordpool site if you use this data and as such the authors of
Predbat accepts no responsibility for any violations:</p>
<p><a href="https://www.nordpoolgroup.com/en/About-us/terms-and-conditions-for-useofwebsite/">https://www.nordpoolgroup.com/en/About-us/terms-and-conditions-for-useofwebsite/</a></p>
<pre><code class="language-yaml">  futurerate_url: 'https://dataportal-api.nordpoolgroup.com/api/DayAheadPrices?date=DATE&amp;market=N2EX_DayAhead&amp;deliveryArea=UK&amp;currency=GBP'
  futurerate_adjust_import: True
  futurerate_adjust_export: False
  futurerate_peak_start: &quot;16:00:00&quot;
  futurerate_peak_end: &quot;19:00:00&quot;
</code></pre>
<h2 id="grid-carbon-intensity">Grid Carbon intensity</h2>
<p>Predbat can also track Carbon intensity by linking it to an integration which provides this data.</p>
<h3 id="uk-grid-carbon-intensity">UK Grid Carbon intensity</h3>
<p>The National Grid provides this data, you can have Predbat fetch it directly by entering your postcode:</p>
<pre><code class="language-yaml">  # Carbon Intensity data from National grid
  carbon_postcode: 'SW1 5NA'
  carbon_automatic: True
</code></pre>
<p>This direct connection will also set <strong>sensor.predbat_carbon</strong> with the current carbon data.</p>
<p>By enabling <strong>switch.predbat_carbon_enable</strong> you can view Carbon Intensity <a href="../predbat-plan-card/">in the predbat plan</a>.</p>
<p>Predbat can also <a href="../customisation/#battery-margins-and-metrics-options">optimise your grid charging based on the Carbon footprint</a> by setting <strong>input_number.predbat_carbon_metric</strong>.</p>
<p><img alt="image" src="https://github.com/springfall2008/batpred/assets/48591903/292c6625-412a-420a-9bd4-df68a937e93c" /></p>
<h3 id="uk-grid-carbon-intensity-ha-integration">UK Grid Carbon intensity (HA Integration)</h3>
<p>If you prefer you can instead install this integration: <a href="https://github.com/jfparis/sensor.carbon_intensity_uk">https://github.com/jfparis/sensor.carbon_intensity_uk</a></p>
<p>Once it is active update apps.yaml to link Predbat to the Sensor (if it's not already in your template):</p>
<pre><code class="language-yaml">  # Carbon Intensity data from National grid
  carbon_intensity: 're:(sensor.carbon_intensity_uk)'
</code></pre>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../inverter-setup/" class="btn btn-neutral float-left" title="Inverter setup"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../apps-yaml/" class="btn btn-neutral float-right" title="apps.yaml settings">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../inverter-setup/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../apps-yaml/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
